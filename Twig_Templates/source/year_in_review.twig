{% extends "fullwidth.twig" %}

{% block content %}
  <script type = "text/javascript" src = "/vendor/components/jquery/jquery.min.js"></script>
  <script type = "text/javascript" src = "/vendor/ifightcrime/bootstrap-growl/jquery.bootstrap-growl.min.js"></script>
  <script type = "text/javascript" language = "javascript">

  //Generic function to retrieve data
  function getListData(url_value,div_value, column_one_header, column_two_header, year_value){
   var formData = {year_value:year_value};
   $.ajax({
       url : url_value,
       type: "POST",
       data : formData,
       dataType : 'json',
       success: function(data, textStatus, jqXHR){
         $(div_value).empty();

         $(div_value).append('<table class="table table-condensed">');
         $(div_value).append('<thead>');
         $(div_value).append('<tr><td><b>' +column_one_header+'</b></td><td>&nbsp;' +column_two_header+'</td></tr>');
         $(div_value).append('</thead>');

         $.each(data, function(key,row) {
           $(div_value).append('<tr>');
           $(div_value).append('<td><b>'+ row.HASHER_NAME + '</b></td>');
           $(div_value).append('<td>&nbsp;'+ row.THE_COUNT + '</td>');
           $(div_value).append('</tr>');
         });

         $(div_value).append('</table>');

       },
       error: function (jqXHR, textStatus, errorThrown){
            alert("failure");
            alert(jqXHR);
            alert(textStatus);
            alert(errorThrown);
       }
   });
  }





//This function loads when the pages loads
 $(document).ready(function() {
    getListData("/{{kennel_abbreviation}}/statistics/getHasherCountsByYear","#hasherCounts-list","Hasher","Count",{{yearValue}});
    {% for hare_type in hare_types %}
      getListData("/{{kennel_abbreviation}}/statistics/getHareCountsByYear/{{hare_type.HARE_TYPE}}","#{{hare_type.HARE_TYPE_NAME}}HareCounts-list","Hasher","Count",{{yearValue}});
    {% endfor %}
    getListData("/{{kennel_abbreviation}}/statistics/getTotalHareCountsByYear","#totalHareCounts-list","Hasher","Count",{{yearValue}});
    getListData("/{{kennel_abbreviation}}/statistics/getNewbieHasherListByYear","#newbieHashers-list","Hasher","Count",{{yearValue}});
    {% for hare_type in hare_types %}
      getListData("/{{kennel_abbreviation}}/statistics/getNewbieHareListByYear/{{hare_type.HARE_TYPE}}","#newbie{{hare_type.HARE_TYPE_NAME}}Hare-list","Hare","Count",{{yearValue}});
    {% endfor %}
    getListData("/{{kennel_abbreviation}}/statistics/getNewbieOverallHareListByYear","#newbieOverallHare-list","Hare","Count",{{yearValue}});
  });

  var column=0;
  var bgcolor='35A1A5';

  function nextBgColor() {
    bgcolor = (bgcolor=='35A1A5' ? '81459E' : '35A1A5');
  }

  function doList(title, subtitle, id) {
    if(column == 4) {
      document.write('</div>');
      column = 0;
      nextBgColor();
    }
    if(column++ == 0) {
      document.write('<div class="row">');
    }
    document.write('<div class="col-sm-3" style="background-color:#' + bgcolor + ';">');
    nextBgColor();
    document.write('<h3>' + title + '</h3>');
    document.write('<h5><i>' + subtitle + '</i></h5>');
    document.write('<a href="#hasherCounts-list" class="btn btn-info" data-toggle="collapse">Show/Hide</a>');
    document.write('<dl class="dl-horizontal">');
    document.write('<div data-role="content">');
    document.write('<ul data-role="listview" id="' + id + '">');
    document.write('</ul>');
    document.write('</div>');
    document.write('</dl>');
    document.write('</div>');
  }
  function endLists() {
    document.write('</div>');
    column = 0;
  }

  </script>

<div class="container">
  <h1>{{pageTitle}}</h1>

  <div class="row">
    <div class="col-sm-4" style="background-color:gold;">
      <h3>Event Details</h3>
      <dl class="dl-horizontal">
          {% autoescape %}
            <dt>Hashes</dt><dd>{{hash_count}}</dd>
            {% for hash_type in hash_types %}
              <dt>{{ hash_type.HASH_TYPE_NAME }} Hashes </dt><dd>{{ hash_counts[hash_type.HASH_TYPE_NAME] }}</dd>
            {% endfor %}
          {% endautoescape %}
      </dl>
    </div>

    <div class="col-sm-4" style="background-color:orange;">
      <h3>People Details</h3>
      <dl class="dl-horizontal">
          {% autoescape %}
            <dt>Hashers</dt><dd>{{hasher_count}}</dd>
            {% for hare_type in hare_types %}
              <dt>{{ hare_type.HARE_TYPE_NAME }} Hares </dt><dd>{{ hare_counts[hare_type.HARE_TYPE_NAME] }}</dd>
            {% endfor %}
            <dt>Overall Hares</dt><dd>{{overall_hare_count}}</dd>
          {% endautoescape %}
      </dl>
    </div>

    <div class="col-sm-4" style="background-color:silver;">
      <h3>Newbie Details</h3>
      <dl class="dl-horizontal">
          {% autoescape %}
            <dt>Newbie Hashers</dt><dd><a href="#newbiehasherlist">{{newbie_hashers_count}}</a></dd>
            {% for hare_type in hare_types %}
            <dt>Newbie {{ hare_type.HARE_TYPE_NAME }} Hares </dt><dd><a href="#newbie{{ hare_type.HARE_TYPE_NAME }}harelist">{{ newbie_hare_counts[hare_type.HARE_TYPE_NAME] }}</a></dd>
            {% endfor %}
            <dt>Newbie Overall Hares</dt><dd><a href="#newbieoverallharelist">{{newbie_overall_hares_count}}</a></dd>
          {% endautoescape %}
      </dl>
    </div>
  </div>

  <script type = "text/javascript" language = "javascript">
      doList('Hasher Counts', '* {{yearValue}} hashing count listed', 'hasherCounts-list');
      {% for hare_type in hare_types %}
        doList('{{ hare_type.HARE_TYPE_NAME }} Haring Counts', '* {{yearValue}} {{ hare_type.HARE_TYPE_NAME }} haring count listed', '{{ hare_type.HARE_TYPE_NAME }}HareCounts-list');
      {% endfor %}
      doList('Overall Haring Counts', '* {{yearValue}} overall haring count listed', 'totalHareCounts-list');
      doList('Newbie Hashers', '* All time hashing count listed', 'newbieHashers-list');
      {% for hare_type in hare_types %}
        doList('Newbie {{ hare_type.HARE_TYPE_NAME }} Hares', '* All time {{ hare_type.HARE_TYPE_NAME }} haring count listed', 'newbie{{ hare_type.HARE_TYPE_NAME }}Hare-list');
      {% endfor %}
      doList('Newbie Overall Hares', '* All time overall haring count listed', 'newbieOverallHare-list');
      endLists();
  </script>

</div>

{% endblock %}
